<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè´­æˆ¿åŠ©æ‰‹ - äºŒæ‰‹æˆ¿ä¿¡æ¯å¹³å°</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>ğŸ  äºŒæ‰‹æˆ¿å¹³å°</h1>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">é¦–é¡µ</a>
                <a href="/ai-assistant.html" class="nav-link active">AIåŠ©æ‰‹</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <section class="ai-section">
            <h2>ğŸ¤– AIè´­æˆ¿åŠ©æ‰‹</h2>
            
            <div class="ai-tabs">
                <button class="tab-btn active" data-tab="recommend">æ™ºèƒ½æ¨è</button>
                <button class="tab-btn" data-tab="chat">æ™ºèƒ½é—®ç­”</button>
            </div>
            
            <!-- æ™ºèƒ½æ¨è -->
            <div class="tab-content" id="recommend" style="display: block;">
                <div class="recommend-form">
                    <h3>æè¿°æ‚¨çš„è´­æˆ¿éœ€æ±‚</h3>
                    <textarea id="requirement" rows="4" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³åœ¨å¸‚ä¸­å¿ƒè´­ä¹°ä¸€å¥—ä¸¤å®¤ä¸€å…çš„æˆ¿å­ï¼Œé¢„ç®—åœ¨200-300ä¸‡ï¼Œé¢ç§¯80-100å¹³ç±³å·¦å³..."></textarea>
                    
                    <div class="filter-options">
                        <h4>ç­›é€‰æ¡ä»¶ï¼ˆå¯é€‰ï¼‰</h4>
                        <div class="filter-grid">
                            <div class="form-group">
                                <label>ä»·æ ¼èŒƒå›´ï¼ˆä¸‡å…ƒï¼‰</label>
                                <div class="input-group">
                                    <input type="number" id="filterMinPrice" placeholder="æœ€ä½">
                                    <span>-</span>
                                    <input type="number" id="filterMaxPrice" placeholder="æœ€é«˜">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>é¢ç§¯èŒƒå›´ï¼ˆã¡ï¼‰</label>
                                <div class="input-group">
                                    <input type="number" id="filterMinArea" placeholder="æœ€å°">
                                    <span>-</span>
                                    <input type="number" id="filterMaxArea" placeholder="æœ€å¤§">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="recommendBtn">è·å–AIæ¨è</button>
                </div>
                
                <div id="recommendResult" class="ai-result" style="display: none;">
                    <h3>æ¨èç»“æœ</h3>
                    <div id="recommendContent"></div>
                </div>
            </div>
            
            <!-- æ™ºèƒ½é—®ç­” -->
            <div class="tab-content" id="chat" style="display: none;">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message assistant">
                            <div class="chat-message-content markdown-body">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯AIè´­æˆ¿åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿæ‚¨å¯ä»¥è¯¢é—®å…³äºæˆ¿äº§ã€è´­æˆ¿æµç¨‹ã€æ”¿ç­–ç­‰æ–¹é¢çš„é—®é¢˜ã€‚
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <textarea id="chatInput" rows="2" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."></textarea>
                        <button class="btn btn-primary" id="sendBtn">å‘é€</button>
                        <button class="btn btn-danger" id="cancelBtn" style="display: none;">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 äºŒæ‰‹æˆ¿ä¿¡æ¯å¹³å°. All rights reserved.</p>
        </div>
    </footer>

    <style>
        .ai-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .ai-section h2 {
            color: #667eea;
            margin-bottom: 1.5rem;
        }
        
        .ai-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .recommend-form textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            margin-bottom: 1.5rem;
        }
        
        .filter-options {
            margin: 1.5rem 0;
        }
        
        .filter-options h4 {
            margin-bottom: 1rem;
            color: #666;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .ai-result {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .ai-result h3 {
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        #recommendContent {
            white-space: pre-wrap;
            line-height: 1.8;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #f8f9fa;
        }
        
        .chat-message {
            margin-bottom: 1rem;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chat-message.user {
            text-align: right;
        }
        
        .chat-message.assistant {
            text-align: left;
        }
        
        .chat-message-content {
            display: inline-block;
            max-width: 70%;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            line-height: 1.6;
        }
        
        .chat-message.user .chat-message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .chat-message.assistant .chat-message-content {
            background: white;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .chat-input-area {
            padding: 1.5rem;
            background: white;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 1rem;
        }
        
        #cancelBtn {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        
        #cancelBtn:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        
        #cancelBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .chat-input-area textarea {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-family: inherit;
        }
        
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .spinner-border {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 0.15em solid #dee2e6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }

        .spinner-border-sm {
            width: 0.9rem;
            height: 0.9rem;
            border-width: 0.12em;
        }

        .me-2 {
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }
        
        .feedback-buttons {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .feedback-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .feedback-btn:hover {
            background: #f0f0f0;
            transform: scale(1.2);
        }

        /* Markdown æ ·å¼ï¼ˆç®€åŒ–ç‰ˆï¼‰ */
        .markdown-body {
            font-size: 1rem;
            line-height: 1.7;
        }
        .markdown-body p { margin: 0.5rem 0; }
        .markdown-body ul { padding-left: 1.2rem; margin: 0.5rem 0; }
        .markdown-body li { margin: 0.25rem 0; }
        .markdown-body code { background: #f5f5f5; padding: 0.2rem 0.35rem; border-radius: 4px; }
        .markdown-body pre { background: #f5f5f5; padding: 0.75rem; border-radius: 6px; overflow: auto; }
    </style>

    <script src="/js/marked.min.js"></script>
    <script src="/js/common.js"></script>
    <script>
        let chatHistory = [];
        let currentAbortController = null;  // ç”¨äºå–æ¶ˆAIè¯·æ±‚
        let currentTypingInterval = null;   // ç”¨äºå–æ¶ˆæ‰“å­—åŠ¨ç”»

        // å¦‚æœæœ¬åœ°æœªæˆåŠŸåŠ è½½markedï¼Œå°è¯•CDNå…œåº•ï¼Œä½†ä¸é˜»å¡ä¸»æµç¨‹
        (function ensureMarkedFallback() {
            if (window.marked) return;
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
            script.async = true;
            script.onload = () => console.log('marked fallback loaded from CDN');
            script.onerror = () => console.warn('marked fallback CDN load failed');
            document.head.appendChild(script);
        })();

        // å°†çº¯æ–‡æœ¬æ¸²æŸ“ä¸ºmarkdownçš„HTMLï¼Œè‹¥markedä¸å¯ç”¨åˆ™é™çº§ä¸ºè½¬ä¹‰æ–‡æœ¬
        function renderMarkdownSafe(text) {
            if (!text) return '';
            if (window.marked && typeof window.marked.parse === 'function') {
                return window.marked.parse(text);
            }
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }
        
        // AIæ¨è
        async function getAIRecommendation() {
            const requirement = document.getElementById('requirement').value;
            
            if (!requirement.trim()) {
                showMessage('è¯·æè¿°æ‚¨çš„è´­æˆ¿éœ€æ±‚', 'error');
                return;
            }
            
            const recommendBtn = document.getElementById('recommendBtn');
            const recommendResult = document.getElementById('recommendResult');
            const recommendContent = document.getElementById('recommendContent');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            recommendBtn.disabled = true;
            recommendBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>æ­£åœ¨åˆ†æ...';
            recommendResult.style.display = 'block';
            recommendContent.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">åŠ è½½ä¸­...</span></div><p class="mt-2">AIæ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚ï¼Œè¯·ç¨å€™...</p></div>';
            
            try {
                // æ„å»ºç­›é€‰æ¡ä»¶
                const filters = {};
                const minPrice = document.getElementById('filterMinPrice').value;
                const maxPrice = document.getElementById('filterMaxPrice').value;
                const minArea = document.getElementById('filterMinArea').value;
                const maxArea = document.getElementById('filterMaxArea').value;
                
                if (minPrice) filters.minPrice = parseFloat(minPrice);
                if (maxPrice) filters.maxPrice = parseFloat(maxPrice);
                if (minArea) filters.minArea = parseFloat(minArea);
                if (maxArea) filters.maxArea = parseFloat(maxArea);
                
                const data = await apiRequest('/api/ai/recommend', {
                    method: 'POST',
                    body: JSON.stringify({
                        requirement: requirement,
                        filters: filters
                    })
                });
                
                if (data.success && data.data) {
                    recommendContent.innerHTML = '<div class="markdown-body">' + renderMarkdownSafe(data.data.recommendation) + '</div>';
                } else {
                    recommendContent.innerHTML = '<div class="alert alert-danger">æ¨èå¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯') + '</div>';
                    showMessage(data.message || 'AIæ¨èå¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('AIæ¨èé”™è¯¯:', error);
                recommendContent.innerHTML = '<div class="alert alert-danger">ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</div>';
                showMessage('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                recommendBtn.disabled = false;
                recommendBtn.textContent = 'è·å–AIæ¨è';
            }
        }
        
        // å‘é€èŠå¤©æ¶ˆæ¯
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            const sendBtn = document.getElementById('sendBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            
            if (!message) {
                return;
            }
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢
            addChatMessage(message, 'user');
            chatInput.value = '';
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            chatHistory.push({
                role: 'user',
                content: message
            });
            
            // åˆ›å»ºAIæ¶ˆæ¯å®¹å™¨ï¼ˆç”¨äºæµå¼æ˜¾ç¤ºï¼‰
            const aiMessageDiv = createChatMessage('', 'assistant');
            const contentDiv = aiMessageDiv.querySelector('.chat-message-content');
            contentDiv.innerHTML = '<span class="typing-indicator">AIæ­£åœ¨æ€è€ƒ...</span>';
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            sendBtn.style.display = 'none';
            cancelBtn.style.display = 'inline-block';
            chatInput.disabled = true;
            
            // åˆ›å»º AbortController
            currentAbortController = new AbortController();
            
            try {
                const response = await fetch('/api/ai/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        history: chatHistory
                    }),
                    signal: currentAbortController.signal
                });
                
                // æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
                if (currentAbortController.signal.aborted) {
                    return;
                }
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const aiResponse = data.data.response;
                    
                    // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                    contentDiv.innerHTML = '';
                    
                    // æ¨¡æ‹Ÿæ‰“å­—æ•ˆæœï¼ˆå…ˆé€å­—ç¬¦æ˜¾ç¤ºçº¯æ–‡æœ¬ï¼Œç»“æŸåæ¸²æŸ“markdownï¼‰
                    let index = 0;
                    const typingSpeed = 30; // æ¯«ç§’
                    let rawBuffer = '';
                    
                    function typeWriter() {
                        // æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
                        if (currentAbortController && currentAbortController.signal.aborted) {
                            return;
                        }
                        
                        if (index < aiResponse.length) {
                            const ch = aiResponse.charAt(index);
                            rawBuffer += ch;
                            contentDiv.textContent = rawBuffer;
                            index++;
                            currentTypingInterval = setTimeout(typeWriter, typingSpeed);
                            
                            // æ»šåŠ¨åˆ°åº•éƒ¨
                            const messagesDiv = document.getElementById('chatMessages');
                            messagesDiv.scrollTop = messagesDiv.scrollHeight;
                        } else {
                            // æ‰“å­—å®Œæˆï¼Œæ·»åŠ åˆ°å†å²è®°å½•
                            chatHistory.push({
                                role: 'assistant',
                                content: aiResponse
                            });
                            
                            // æœ€ç»ˆç”¨markdownæ¸²æŸ“
                            contentDiv.innerHTML = '<div class="markdown-body">' + renderMarkdownSafe(aiResponse) + '</div>';
                            
                            // æ·»åŠ åé¦ˆæŒ‰é’®
                            addFeedbackButtons(aiMessageDiv);
                            
                            // æ¢å¤æŒ‰é’®çŠ¶æ€
                            resetChatInputState();
                        }
                    }
                    
                    typeWriter();
                } else {
                    contentDiv.textContent = 'æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯');
                    contentDiv.style.color = '#dc3545';
                    resetChatInputState();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    // ç”¨æˆ·å–æ¶ˆäº†è¯·æ±‚
                    contentDiv.innerHTML = '<span style="color: #999; font-style: italic;">å·²å–æ¶ˆ</span>';
                    console.log('ç”¨æˆ·å–æ¶ˆäº†AIè¯·æ±‚');
                } else {
                    console.error('AIè¯·æ±‚å¤±è´¥:', error);
                    contentDiv.textContent = 'æŠ±æ­‰ï¼Œç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
                    contentDiv.style.color = '#dc3545';
                }
                resetChatInputState();
            }
        }
        
        // å–æ¶ˆAIè¯·æ±‚
        function cancelChatMessage() {
            if (currentAbortController) {
                currentAbortController.abort();
                currentAbortController = null;
            }
            
            if (currentTypingInterval) {
                clearTimeout(currentTypingInterval);
                currentTypingInterval = null;
            }
            
            resetChatInputState();
            console.log('AIè¯·æ±‚å·²å–æ¶ˆ');
        }
        
        // é‡ç½®èŠå¤©è¾“å…¥çŠ¶æ€
        function resetChatInputState() {
            const sendBtn = document.getElementById('sendBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const chatInput = document.getElementById('chatInput');
            
            sendBtn.style.display = 'inline-block';
            cancelBtn.style.display = 'none';
            chatInput.disabled = false;
            currentAbortController = null;
            currentTypingInterval = null;
        }
        
        // åˆ›å»ºèŠå¤©æ¶ˆæ¯å…ƒç´ 
        function createChatMessage(content, role) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'chat-message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            return messageDiv;
        }
        
        // æ·»åŠ èŠå¤©æ¶ˆæ¯åˆ°ç•Œé¢ï¼ˆç”¨æˆ·æ¶ˆæ¯ç”¨çº¯æ–‡æœ¬ï¼ŒAIæ¶ˆæ¯åœ¨æ‰“å­—åæ‰æ¸²æŸ“markdownï¼‰
        function addChatMessage(content, role, isLoading = false) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'chat-message-content';
            
            // ç”¨æˆ·æ¶ˆæ¯ç›´æ¥æ˜¾ç¤ºæ–‡æœ¬ï¼ŒAIæ¶ˆæ¯ç”¨markdown
            if (role === 'user') {
                contentDiv.textContent = content;
            } else {
                contentDiv.innerHTML = '<div class="markdown-body">' + renderMarkdownSafe(content) + '</div>';
            }
            
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            return messageDiv;
        }
        
        // æ·»åŠ åé¦ˆæŒ‰é’®
        function addFeedbackButtons(messageDiv) {
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = 'feedback-buttons';
            feedbackDiv.innerHTML = `
                <button class="feedback-btn" onclick="provideFeedback(this, 'helpful')" title="æœ‰å¸®åŠ©">ğŸ‘</button>
                <button class="feedback-btn" onclick="provideFeedback(this, 'not-helpful')" title="æ²¡å¸®åŠ©">ğŸ‘</button>
            `;
            messageDiv.appendChild(feedbackDiv);
        }
        
        // æä¾›åé¦ˆ
        function provideFeedback(button, type) {
            const feedbackDiv = button.parentElement;
            if (type === 'helpful') {
                feedbackDiv.innerHTML = '<span style="color: #28a745;">âœ“ æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼</span>';
                showMessage('æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œæˆ‘ä»¬ä¼šç»§ç»­æ”¹è¿›', 'success');
            } else {
                feedbackDiv.innerHTML = '<span style="color: #dc3545;">æˆ‘ä»¬ä¼šåŠªåŠ›æ”¹è¿›</span>';
                showMessage('æŠ±æ­‰æœªèƒ½å¸®åˆ°æ‚¨ï¼Œæˆ‘ä»¬ä¼šç»§ç»­æ”¹è¿›', 'info');
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // åˆ‡æ¢å†…å®¹
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    document.getElementById(tabName).style.display = 'block';
                });
            });
            
            // AIæ¨èæŒ‰é’®
            const recommendBtn = document.getElementById('recommendBtn');
            if (recommendBtn) {
                recommendBtn.addEventListener('click', getAIRecommendation);
            }
            
            // å‘é€æŒ‰é’®
            const sendBtn = document.getElementById('sendBtn');
            if (sendBtn) {
                sendBtn.addEventListener('click', sendChatMessage);
            }
            
            // å–æ¶ˆæŒ‰é’®
            const cancelBtn = document.getElementById('cancelBtn');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', cancelChatMessage);
            }
            
            // å›è½¦å‘é€
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
        });
    </script>
</body>
</html>
